const bundleButton = document.querySelector('[bundle_apk] button'); if (bundleButton) { bundleButton.addEventListener('click', async (e) => { const button = e.currentTarget; button.style.opacity = 0.5; const selectedExtras = document.querySelectorAll('[bundle_apk]>div>div'); const cartAddUrl = '/cart/add.js'; for (const extra of selectedExtras) { const variantId = extra.dataset.variantId; if (!variantId) continue; const addonData = new FormData(); addonData.append('id', variantId); addonData.append('quantity', 1); await fetch(cartAddUrl, { method: 'POST', headers: { 'X-Requested-With': 'XMLHttpRequest', }, body: addonData, }); } const event = new CustomEvent('apps:product-added-to-cart'); document.dispatchEvent(event); document.querySelector('[data-js-cart-icon]').click(); button.style.opacity = 1; }); }
